<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAPS - Tienda Oficial</title>
    
    <!-- 1. MOTORES ESENCIALES (React + Tailwind) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 0.5s ease-out; }
        /* Estilo para evitar parpadeos */
        body { font-family: sans-serif; -webkit-font-smoothing: antialiased; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Aquí se montará la app -->
    <div id="root"></div>

    <!-- Detector de Errores (Por si algo falla, te avisa) -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.body.innerHTML = '<div style="padding:20px; color:red; text-align:center;"><h1>Ups! Algo falló</h1><p>'+message+'</p></div>';
        };
    </script>

    <!-- 2. CÓDIGO DE LA APP -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ÍCONOS SVG (Para no depender de librerías externas) ---
        const IconCart = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>;
        const IconSearch = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconMenu = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>;
        const IconBot = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const IconSend = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>;
        const IconStore = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></svg>;

        // --- APP PRINCIPAL ---
        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('login'); 
            const [cart, setCart] = useState([]);
            const [search, setSearch] = useState('');
            const [menuOpen, setMenuOpen] = useState(false);
            const [usersDb, setUsersDb] = useState([]);
            const [aiOpen, setAiOpen] = useState(false);
            const [aiMsg, setAiMsg] = useState([{role:'sys', text:'Hola, soy el Asistente SAPS.'}]);
            const [aiIn, setAiIn] = useState('');

            const countries = {
                "México": ["Aguascalientes", "Baja California", "CDMX", "Jalisco", "Nuevo León", "Puebla"],
                "USA": ["California", "Texas", "Florida", "New York"],
                "Colombia": ["Bogotá", "Medellín", "Cali"],
                "España": ["Madrid", "Barcelona"]
            };
            const [checkout, setCheckout] = useState({ country: '', state: '', address: '', method: 'card' });

            const [products, setProducts] = useState([
                { id: 1, name: 'Audífonos Pro', price: 1200, img: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400', seller: 'TechStore', discount: false },
                { id: 2, name: 'Tenis Runner', price: 850, original: 1100, img: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400', seller: 'ShoeKing', discount: true },
                { id: 3, name: 'Smartwatch V2', price: 2500, img: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400', seller: 'GadgetW', discount: false },
                { id: 4, name: 'Mochila Viaje', price: 600, original: 850, img: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400', seller: 'TravelCo', discount: true },
                { id: 5, name: 'Cámara Reflex', price: 8500, original: 9200, img: 'https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=400', seller: 'FotoPro', discount: true },
            ]);

            useEffect(() => {
                const u = localStorage.getItem('saps_u');
                const db = localStorage.getItem('saps_db');
                if(u) { setUser(JSON.parse(u)); setView('home'); }
                if(db) setUsersDb(JSON.parse(db));
            }, []);

            const login = (e) => {
                e.preventDefault();
                const found = usersDb.find(u => u.email === e.target.email.value && u.pass === e.target.pass.value);
                if(found) { setUser(found); localStorage.setItem('saps_u', JSON.stringify(found)); setView('home'); }
                else alert('Datos incorrectos.');
            };

            const register = (e) => {
                e.preventDefault();
                const newUser = { name: e.target.name.value, email: e.target.email.value, pass: e.target.pass.value, addr: e.target.addr.value };
                const newDb = [...usersDb, newUser];
                setUsersDb(newDb); localStorage.setItem('saps_db', JSON.stringify(newDb));
                alert('¡Creado! Inicia sesión.'); setView('login');
            };

            const logout = () => { setUser(null); setCart([]); localStorage.removeItem('saps_u'); setView('login'); };
            const addCart = (p) => { setCart([...cart, p]); alert('Agregado'); };
            
            const pay = (e) => {
                e.preventDefault();
                alert(`¡Compra Exitosa ${user.name}!\nTotal: $${cart.reduce((a,b)=>a+b.price,0)}\nEnviando a: ${checkout.address}, ${checkout.state}, ${checkout.country}\nNotificación enviada a: thiago_silva2012@icloud.com`);
                setCart([]); setView('home');
            };

            const sendAi = (e) => {
                e.preventDefault();
                if(!aiIn) return;
                const msgs = [...aiMsg, {role:'user', text:aiIn}];
                setAiMsg(msgs); setAiIn('');
                setTimeout(() => setAiMsg([...msgs, {role:'sys', text:'Busca en nuestras ofertas o usa la barra de búsqueda.'}]), 1000);
            };

            const Logo = () => <div onClick={()=>setView('home')} className="text-2xl font-black cursor-pointer select-none flex"><span className="text-green-600">S</span><span className="text-blue-600">A</span><span className="text-yellow-500">P</span><span className="text-red-600">S</span></div>;

            if(!user && view === 'login') return (
                <div className="min-h-screen flex items-center justify-center bg-gray-100 p-4"><div className="bg-white p-8 rounded-xl shadow-xl w-full max-w-sm animate-fade"><div className="flex justify-center mb-6"><Logo/></div><h2 className="text-center font-bold text-xl mb-4">Iniciar Sesión</h2><form onSubmit={login} className="space-y-4"><input name="email" placeholder="Correo" className="w-full border p-2 rounded" required /><input type="password" name="pass" placeholder="Contraseña" className="w-full border p-2 rounded" required /><button className="w-full bg-yellow-400 py-2 rounded font-bold">Entrar</button></form><button onClick={()=>setView('register')} className="w-full mt-4 text-blue-600 text-sm">Crear cuenta</button><p className="text-center text-xs text-gray-400 mt-6">Hecho para Thiago</p></div></div>
            );

            if(!user && view === 'register') return (
                <div className="min-h-screen flex items-center justify-center bg-gray-100 p-4"><div className="bg-white p-8 rounded-xl shadow-xl w-full max-w-sm animate-fade"><div className="flex justify-center mb-6"><Logo/></div><h2 className="text-center font-bold text-xl mb-4">Crear Cuenta</h2><form onSubmit={register} className="space-y-3"><input name="name" placeholder="Tu Nombre" className="w-full border p-2 rounded" required /><input name="addr" placeholder="Dirección" className="w-full border p-2 rounded" required /><input name="email" placeholder="Correo" className="w-full border p-2 rounded" required /><input type="password" name="pass" placeholder="Contraseña" className="w-full border p-2 rounded" required /><button className="w-full bg-green-600 text-white py-2 rounded font-bold">Registrarme</button></form><button onClick={()=>setView('login')} className="w-full mt-4 text-blue-600 text-sm">Volver</button></div></div>
            );

            return (
                <div className="min-h-screen flex flex-col font-sans bg-gray-50">
                    <header className="bg-gray-900 text-white sticky top-0 z-50 shadow-md">
                        <div className="p-3 container mx-auto flex justify-between items-center gap-2">
                            <div className="flex items-center gap-2"><button onClick={()=>setMenuOpen(!menuOpen)} className="md:hidden"><IconMenu/></button><Logo/></div>
                            <div className="hidden md:flex flex-1 mx-4 relative"><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Buscar..." className="w-full p-2 rounded text-black outline-none"/><span className="absolute right-2 top-2 text-gray-500"><IconSearch/></span></div>
                            <div className="flex items-center gap-4 text-sm">
                                <button onClick={()=>setAiOpen(!aiOpen)} className="flex flex-col items-center hover:text-yellow-400"><IconBot/><span className="text-xs">IA</span></button>
                                <button onClick={()=>setView('cart')} className="flex flex-col items-center hover:text-yellow-400"><IconCart/><span className="text-xs font-bold">({cart.length})</span></button>
                                <div className="hidden md:block cursor-pointer" onClick={()=>setView('home')}><p className="text-xs text-gray-400">Hola, {user.name}</p></div>
                            </div>
                        </div>
                        <div className="bg-gray-800 text-sm py-2 px-4 flex gap-4 overflow-x-auto whitespace-nowrap">
                            <button onClick={()=>setView('home')} className="font-bold hover:text-yellow-400">Todo</button>
                            <button onClick={()=>setView('deals')} className="hover:text-yellow-400">Ofertas</button>
                            <button onClick={()=>setView('sell')} className="hover:text-yellow-400 font-bold text-yellow-500 ml-auto flex gap-1 items-center"><IconStore/> Vender</button>
                        </div>
                    </header>

                    {menuOpen && <div className="fixed inset-0 bg-black/50 z-40 md:hidden" onClick={()=>setMenuOpen(false)}><div className="bg-white w-3/4 h-full p-4 text-black animate-fade"><h3 className="font-bold text-lg mb-4 border-b pb-2">Hola, {user.name}</h3><button onClick={()=>{setView('home');setMenuOpen(false)}} className="block py-2 w-full text-left">Inicio</button><button onClick={()=>{setView('cart');setMenuOpen(false)}} className="block py-2 w-full text-left">Carrito</button><button onClick={logout} className="block py-2 w-full text-left text-red-600 font-bold mt-4">Cerrar Sesión</button></div></div>}

                    {aiOpen && <div className="fixed top-16 right-2 w-72 h-80 bg-white shadow-2xl rounded-lg flex flex-col border z-50 animate-fade text-black"><div className="bg-blue-600 text-white p-2 flex justify-between font-bold"><span>SAPS Bot</span><button onClick={()=>setAiOpen(false)}><IconX/></button></div><div className="flex-1 overflow-y-auto p-2 space-y-2">{aiMsg.map((m,i)=><div key={i} className={`p-2 rounded text-sm ${m.role==='user'?'bg-blue-100 ml-auto max-w-[80%]':'bg-gray-100 max-w-[80%]'}`}>{m.text}</div>)}</div><form onSubmit={sendAi} className="p-2 border-t flex gap-1"><input value={aiIn} onChange={e=>setAiIn(e.target.value)} className="flex-1 border rounded p-1 text-sm" placeholder="..."/><button className="bg-blue-600 text-white p-1 rounded"><IconSend/></button></form></div>}

                    <main className="container mx-auto p-4 flex-1 max-w-5xl">
                        {view === 'home' && (
                            <div className="space-y-6 animate-fade">
                                {!search && <div className="bg-gradient-to-r from-gray-800 to-gray-600 h-32 rounded-lg flex items-center justify-center text-white text-center p-4 shadow"><h2 className="text-2xl font-bold">Bienvenido a SAPS<br/><span className="text-sm font-normal">Envíos a {user.addr}</span></h2></div>}
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {products.filter(p=>p.name.toLowerCase().includes(search.toLowerCase())).map(p=>(
                                        <div key={p.id} className="bg-white rounded shadow overflow-hidden flex flex-col group relative">
                                            {p.discount && <span className="absolute top-1 right-1 bg-red-600 text-white text-[10px] px-2 rounded font-bold">OFERTA</span>}
                                            <img src={p.img} className="h-32 w-full object-cover bg-gray-200" onError={e=>e.target.src='https://via.placeholder.com/150'}/>
                                            <div className="p-3 flex-1 flex flex-col">
                                                <h3 className="font-bold text-sm mb-1 line-clamp-2">{p.name}</h3>
                                                <div className="mt-auto pt-2"><p className="text-lg font-bold">${p.price}</p><button onClick={()=>addCart(p)} className="w-full bg-yellow-400 text-xs font-bold py-2 rounded mt-2 hover:bg-yellow-500">Agregar</button></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'cart' && (
                            <div className="bg-white p-4 rounded shadow animate-fade"><h2 className="text-xl font-bold mb-4 border-b pb-2">Carrito ({cart.length})</h2>{cart.length === 0 ? <p className="text-gray-500 text-center py-8">Vacío</p> : <>{cart.map((item,i)=><div key={i} className="flex justify-between py-3 border-b items-center"><div className="flex items-center gap-2"><img src={item.img} className="w-10 h-10 rounded object-cover"/><span>{item.name}</span></div><div className="flex items-center gap-3"><span className="font-bold">${item.price}</span><button onClick={()=>setCart(cart.filter((_,x)=>x!==i))} className="text-red-500 font-bold">X</button></div></div>)}<div className="mt-4 text-right"><p className="font-bold text-xl mb-4">Total: ${cart.reduce((a,b)=>a+b.price,0)}</p><button onClick={()=>setView('checkout')} className="bg-yellow-400 px-8 py-3 rounded font-bold hover:bg-yellow-500">Pagar</button></div></>}</div>
                        )}

                        {view === 'sell' && (
                            <div className="bg-white p-6 rounded shadow max-w-lg mx-auto border-t-4 border-green-600 animate-fade"><h2 className="text-xl font-bold mb-4">Vender Producto</h2><form onSubmit={(e)=>{e.preventDefault(); setProducts([...products, {id:Date.now(), name:e.target.title.value, price:Number(e.target.price.value), img:'https://via.placeholder.com/150', discount:false}]); setView('home'); alert('Publicado');}} className="space-y-4"><input name="title" placeholder="Título" className="w-full p-2 border rounded" required/><input name="price" type="number" placeholder="Precio" className="w-full p-2 border rounded" required/><button className="w-full bg-green-600 text-white font-bold py-3 rounded">Publicar</button></form></div>
                        )}

                        {view === 'checkout' && (
                            <div className="bg-white p-6 rounded shadow max-w-xl mx-auto animate-fade">
                                <h2 className="text-xl font-bold mb-6 border-b pb-2">Finalizar Compra</h2>
                                <form onSubmit={pay} className="space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold">País</label><select className="w-full border p-2 rounded bg-white" value={checkout.country} onChange={e=>setCheckout({...checkout, country:e.target.value})}><option value="">Selecciona</option>{Object.keys(countries).map(c=><option key={c}>{c}</option>)}</select></div>
                                        <div><label className="text-xs font-bold">Estado</label><select className="w-full border p-2 rounded bg-white" disabled={!checkout.country}><option>Selecciona</option>{checkout.country && countries[checkout.country].map(s=><option key={s}>{s}</option>)}</select></div>
                                    </div>
                                    <input placeholder="Dirección" className="w-full p-2 border rounded" required value={checkout.address} onChange={e=>setCheckout({...checkout, address:e.target.value})}/>
                                    <div className="bg-gray-50 p-3 rounded border"><h3 className="font-bold text-sm mb-2">Pago</h3><div className="flex gap-4"><label><input type="radio" name="pay" defaultChecked/> Tarjeta</label><label><input type="radio" name="pay"/> Efectivo</label></div></div>
                                    <button className="w-full bg-yellow-400 px-6 py-3 rounded font-bold">Confirmar</button>
                                </form>
                                <button onClick={()=>setView('cart')} className="mt-4 text-blue-600 underline text-sm w-full text-center">Cancelar</button>
                            </div>
                        )}
                        
                        {(view === 'deals' || view === 'gift-cards') && <div className="text-center py-10"><h2 className="text-xl font-bold">Sección en Construcción</h2><button onClick={()=>setView('home')} className="text-blue-600 mt-4">Volver</button></div>}
                    </main>
                    <footer className="bg-gray-900 text-white text-center p-6 text-xs mt-auto">© 2025 SAPS Inc. - Hecho para Thiago</footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>



